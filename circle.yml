machine:
  node:
    version: 6
  php:
    version: 7.0.20
  timezone:
    Europe/Copenhagen

  # This will be added to the `/etc/hosts` file
  hosts:
    wppusher-plugin.dev: 127.0.0.1

dependencies:
  pre:
    # No password is required for the MySQL user `ubuntu`
    - mysql -u ubuntu -e "create database wordpress"
    - sudo add-apt-repository ppa:ondrej/php -y
    # - sudo apt-get install libapache2-mod-php5
    # - sudo apt-get update
    # - sudo apt-get install curl -y
    # - sudo apt-get install php5.6 -y
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    - sudo dpkg -i google-chrome*.deb
    - npm install -g npm
    - npm install
    
    # Use cURL to fetch WP-CLI

  post:
    # Copy Apache conf into `site-available`
    - sudo rm /etc/apache2/mods-enabled/php5.load
    - sudo cp ~/clean/apache-ci.conf /etc/apache2/sites-available
    - sudo add-apt-repository ppa:ondrej/php -y 
    - sudo apt-get update
    - sudo apt-get purge php5-common # remove and purge old PHP 5.x packages
    - sudo apt-get update # I had to run the update command again
    - sudo apt-get install php7.0
    
    # Use `a2ensite` to create a symlink for the config
    - sudo a2ensite apache-ci.conf
    
    # Restart the Apache server
    # - sudo apt-get purge libapache2-mod-php5
    # - sudo apt-get update && sudo apt-get install libapache2-mod-php5
    - sudo service apache2 restart


    - sudo apt-get install php7.0-gd
    - sudo apt-get install php7.0-intl
    - sudo apt-get install php7.0-zip
    - sudo apt-get install php7.0-mbstring php7.0-mcrypt php7.0-mysql php7.0-xml -y
    - sudo apt-get install php7.0-xml -y
    - sudo service apache2 restart
    - cd ~/clean
    - sudo rm -rf /usr/local/bin/composer
    - sudo curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
    - sudo php /usr/local/bin/composer init --no-interaction
    - sudo php /usr/local/bin/composer config -a http-basic.repo.magento.com e3fe1cabf752165bd79fbbbcb0e626fd 11543462ae0104c9792bd3d79b57663a
    - sudo mkdir /var/www/html/magento2
    - sudo php /usr/local/bin/composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition=2.1.9 /var/www/html/magento2
    - sudo chmod -R 777 /var/www/html/magento2
    - sudo php /usr/local/bin/composer install
    

test:
  override:
    # This is just for us to see that the WP Pusher plugin was actually installed and is active
    - npm run start
    
    # Finally, run our Behat features
    # - vendor/bin/behat