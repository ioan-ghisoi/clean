version: 2

machine:
  node:
    version: 6

dependencies:
  cache_directories:
    - "node_modules"
    - "~/.npm"

  override:
    # Hack to use newer v. of phantom needs to update Chrome
    - sudo apt-get install libxss1 libappindicator1 libindicator7 lsb-base
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    - sudo dpkg -i google-chrome*.deb
    - npm install -g npm
    - npm install
  post:
    # - npm run start-ci #  :
    # - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    # - tar -xzf sc-latest-linux.tar.gz

test:
  pre:
    # - npm run test
    # - sleep 30
    # - cd sc-*-linux && ./bin/sc --user "yanns" --api-key "ac8561a1-ba7f-42c6-afd9-1dad08bac0d7" --readyfile ~/sauce_is_ready:
    #     background: true
    # # Wait for tunnel to be ready
    # - while [ ! -e ~/sauce_is_ready ]; do sleep 1; done

  post:
  - npm run chimp-ci
  #- cat ./coverage/lcov.info | ./node_modules/.bin/codacy-coverage && rm -rf ./coverage
    #- chimp chimp.js --browser="Safari" --platform="iOS" --platformVersion="9.3" --deviceName="iPhone 6 Simulator"
    # - chimp chimp.js --browser="android" --platform="linux" --deviceType="phone"

general:
  artifacts:
    - ".screenshots"